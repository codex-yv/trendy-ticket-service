<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://static.readdy.ai/static/e.js"></script>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Ticket Verification - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet" />
    <!-- jsQR fallback (used only if BarcodeDetector is unavailable) -->
    <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#F59E0B',
                        secondary: '#10B981'
                    },
                    borderRadius: {
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                        'button': '8px'
                    }
                }
            }
        }
    </script>
    <style>
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }

        body {
            background-color: #F8F6F0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .scan-button {
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .scan-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .scan-button:active {
            transform: translateY(0);
        }

        .status-card {
            transition: all 0.4s ease;
            transform: translateY(10px);
            opacity: 0;
        }

        .status-card.show {
            transform: translateY(0);
            opacity: 1;
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        #camera-preview {
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }

        .verification-success {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border: 2px solid #10B981;
        }

        .verification-error {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border: 2px solid #EF4444;
        }

        .verification-scanning {
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
            border: 2px solid #3B82F6;
        }

        @font-face {
            font-family: 'Pacifico';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/pacifico/v23/FwZY7-Qmy14u9lezJ96A.ttf) format('truetype');
        }

        /* QR Scanner Styles */
        .qr-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            display: grid;
            place-items: center;
        }

        .qr-box {
            width: min(75vmin, 300px);
            height: min(75vmin, 300px);
            border-radius: 14px;
            outline: 9999px solid rgba(0, 0, 0, 0.35);
            border: 2px dashed rgba(255, 255, 255, 0.35);
            box-shadow: 0 0 0 120vmax rgba(0, 0, 0, 0.2);
        }

        .qr-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 1px solid #1e2b50;
            background: #0d1732;
            color: #cfe0ff;
            border-radius: 999px;
            font-size: 12px;
        }

        .qr-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .qr-dot.ok {
            background: #35d07f;
        }

        .qr-dot.warn {
            background: #ffb74d;
        }

        .qr-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 16px;
        }

        .qr-button {
            appearance: none;
            border: none;
            border-radius: 12px;
            padding: 10px 14px;
            font-weight: 700;
            background: #14265a;
            color: #eaf0ff;
            cursor: pointer;
        }

        .qr-button:hover {
            background: #1b3272;
        }

        .qr-button:disabled {
            opacity: .6;
            cursor: not-allowed;
        }

        .qr-result {
            padding: 10px;
            border: 1px dashed #1e2b50;
            background: #0e1835;
            border-radius: 12px;
            color: #eaf0ff;
            margin-top: 16px;
        }

        .qr-mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            word-break: break-word;
        }

        .qr-scanner-info {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 16px;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 256px;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
        }
        
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-md mx-auto px-4 py-6">
                <div class="text-center">
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">Ticket Verification</h1>
                    <p class="text-sm text-gray-600">Admin Panel - Scan QR codes to verify tickets</p>
                </div>
            </div>
        </header>
        <main class="flex-1 flex flex-col items-center justify-center px-4 py-8">
            <div class="w-full max-w-md space-y-6">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center">
                        <i class="ri-qr-scan-2-line text-3xl text-primary"></i>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-2">Ready to Scan</h2>
                    <p class="text-gray-600 text-sm">Tap the button below to start scanning QR codes</p>
                </div>
                <div class="text-center">
                    <button
                        class="scan-button bg-primary hover:bg-primary/90 text-white font-semibold py-4 px-8 !rounded-button whitespace-nowrap w-full max-w-xs mx-auto flex items-center justify-center gap-3 text-lg"
                        id="scanButton">
                        <div class="w-6 h-6 flex items-center justify-center">
                            <i class="ri-camera-line text-xl"></i>
                        </div>
                        Scan QR Code
                    </button>
                </div>
                <div class="hidden" id="cameraContainer">
                    <div class="bg-white rounded-lg p-4 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Camera Scanner</h3>
                            <button
                                class="w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 !rounded-button"
                                id="closeCameraButton">
                                <i class="ri-close-line text-gray-600"></i>
                            </button>
                        </div>
                        <div class="qr-scanner-info">
                            <span id="osBadge" class="qr-badge"><span class="qr-dot warn"></span>Detecting OS…</span>
                            <span id="camBadge" class="qr-badge"><span class="qr-dot warn"></span>Preparing camera…</span>
                            <span id="supportBadge" class="qr-badge"><span class="qr-dot warn"></span>Checking support…</span>
                        </div>
                        <div class="video-container" id="camera-preview">
                            <video id="video" playsinline class="w-full h-full object-cover hidden"></video>
                            <div class="qr-overlay">
                                <div class="qr-box" aria-hidden="true"></div>
                            </div>
                            <div class="absolute inset-0 text-white text-center flex flex-col items-center justify-center" id="camera-placeholder">
                                <div class="w-12 h-12 mx-auto mb-3 flex items-center justify-center">
                                    <i class="ri-camera-line text-2xl pulse-animation"></i>
                                </div>
                                <p class="text-sm">Position QR code within the frame</p>
                            </div>
                        </div>
                        <div class="qr-controls">
                            <button class="qr-button" id="startBtn">Start Camera</button>
                            <button class="qr-button" id="flipBtn" disabled>Flip Camera</button>
                            <button class="qr-button" id="stopBtn" disabled>Stop Camera</button>
                        </div>
                        <div id="qrResult" class="qr-result hidden">
                            <strong>QR Data:</strong>
                            <div id="qrText" class="qr-mono mt-2 mb-4"></div>
                            <div class="flex gap-2 justify-center">
                                <button class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 !rounded-button" id="verifyTicketBtn">Verify Ticket</button>
                                <button class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 !rounded-button" id="cancelScanBtn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="status-card" id="statusContainer">
                    <div class="rounded-lg p-6 text-center hidden" id="statusCard">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center"
                            id="statusIcon">
                            <i class="text-2xl" id="statusIconElement"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2" id="statusTitle"></h3>
                        <p class="text-sm mb-4" id="statusMessage"></p>
                        <div class="bg-white/50 rounded p-4 text-left text-sm space-y-2 hidden" id="ticketDetails">
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Ticket ID:</span>
                                <span class="text-gray-900" id="ticketId"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Event:</span>
                                <span class="text-gray-900" id="eventName"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Date:</span>
                                <span class="text-gray-900" id="eventDate"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Holder:</span>
                                <span class="text-gray-900" id="ticketHolder"></span>
                            </div>
                        </div>
                        <button
                            class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 !rounded-button whitespace-nowrap mt-4"
                            id="scanAgainButton">
                            Scan Another Ticket
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                    <h3 class="font-semibold text-gray-900 mb-3 text-center">Recent Scans</h3>
                    <div class="space-y-2" id="recentScans">
                        <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded">
                            <div class="flex items-center gap-3">
                                <div class="w-6 h-6 flex items-center justify-center bg-green-100 rounded-full">
                                    <i class="ri-check-line text-green-600 text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">TK-2024-001</p>
                                    <p class="text-xs text-gray-500">2 minutes ago</p>
                                </div>
                            </div>
                            <span class="text-xs text-green-600 font-medium">Valid</span>
                        </div>
                        <div class="flex items-center justify-between py-2 px-3 bg-gray-50 rounded">
                            <div class="flex items-center gap-3">
                                <div class="w-6 h-6 flex items-center justify-center bg-red-100 rounded-full">
                                    <i class="ri-close-line text-red-600 text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">TK-2024-002</p>
                                    <p class="text-xs text-gray-500">5 minutes ago</p>
                                </div>
                            </div>
                            <span class="text-xs text-red-600 font-medium">Invalid</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <canvas id="canvas" style="display:none"></canvas>

    <script>
        // ------- OS / Environment helpers -------
        const isAndroid = () => {
            const ua = navigator.userAgent || "";
            const uaData = navigator.userAgentData;
            return (uaData && uaData.mobile) || /Android/i.test(ua);
        };
        const isDesktop = () => !isAndroid();

        // ------- UI refs -------
        const osBadge = document.getElementById('osBadge');
        const camBadge = document.getElementById('camBadge');
        const supportBadge = document.getElementById('supportBadge');

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });

        const startBtn = document.getElementById('startBtn');
        const flipBtn = document.getElementById('flipBtn');
        const stopBtn = document.getElementById('stopBtn');

        const qrResult = document.getElementById('qrResult');
        const qrText = document.getElementById('qrText');
        const verifyTicketBtn = document.getElementById('verifyTicketBtn');
        const cancelScanBtn = document.getElementById('cancelScanBtn');

        const scanButton = document.getElementById('scanButton');
        const cameraContainer = document.getElementById('cameraContainer');
        const closeCameraButton = document.getElementById('closeCameraButton');
        const cameraPlaceholder = document.getElementById('camera-placeholder');

        // ------- State -------
        let currentStream = null;
        let lastFacing = null; // 'user' | 'environment'
        let rafId = null;
        let detector = null;
        let usingBarcodeDetector = false;
        let scanningActive = false;
        let scannedData = null;

        // ------- Badges -------
        function setBadge(badge, ok, text) {
            const dot = badge.querySelector('.qr-dot') || document.createElement('span');
            dot.className = 'qr-dot ' + (ok ? 'ok' : 'warn');
            if (!badge.querySelector('.qr-dot')) badge.prepend(dot);
            badge.childNodes[badge.childNodes.length - 1].textContent = text;
        }

        // ------- Init env badges -------
        const os = isAndroid() ? 'Android' : 'PC';
        setBadge(osBadge, true, os);

        // ------- Feature detection -------
        (async () => {
            if ('BarcodeDetector' in window) {
                try {
                    detector = new BarcodeDetector({ formats: ['qr_code'] });
                    usingBarcodeDetector = true;
                    setBadge(supportBadge, true, 'BarcodeDetector ready');
                } catch {
                    usingBarcodeDetector = false;
                    setBadge(supportBadge, false, 'Using jsQR fallback');
                }
            } else {
                usingBarcodeDetector = false;
                setBadge(supportBadge, false, 'Using jsQR fallback');
            }
        })();

        // ------- Camera enumeration -------
        async function listVideoDevices() {
            const devices = await navigator.mediaDevices.enumerateDevices();
            return devices.filter(d => d.kind === 'videoinput');
        }

        async function pickDeviceByFacing(facing) {
            const videos = await listVideoDevices();
            // Try label hints first
            const match = videos.find(d => {
                const label = (d.label || '').toLowerCase();
                if (facing === 'environment')
                    return /back|rear|environment|wide/.test(label);
                return /front|user|face/.test(label);
            });
            if (match) return match.deviceId;
            // Heuristic fallback: first for front, last for back on mobile
            return facing === 'environment' ? (videos[videos.length - 1]?.deviceId || null)
                                            : (videos[0]?.deviceId || null);
        }

        // ------- Camera control -------
        async function startCamera(facing = null, deviceId = null) {
            stopCamera();
            scanningActive = false;
            qrResult.classList.add('hidden');

            const desiredFacing = facing || (isAndroid() ? 'environment' : 'user');
            lastFacing = desiredFacing;

            setBadge(camBadge, true, desiredFacing === 'environment' ? 'Back camera' : 'Front camera');

            const videoConstraints = {};
            if (deviceId) {
                videoConstraints.deviceId = { exact: deviceId };
            } else {
                videoConstraints.facingMode = { ideal: desiredFacing };
            }
            // Aim for decent resolution for QR detection
            videoConstraints.width = { ideal: 1280 };
            videoConstraints.height = { ideal: 720 };

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: videoConstraints, audio: false });
                currentStream = stream;
                video.srcObject = stream;
                await video.play();
                
                // Hide placeholder and show video
                cameraPlaceholder.classList.add('hidden');
                video.classList.remove('hidden');

                // Enable controls
                flipBtn.disabled = false;
                stopBtn.disabled = false;

                // Start scanning
                scanningActive = true;
                scanLoop();
            } catch (e) {
                console.error('getUserMedia error', e);
                alert('Could not access camera. Check HTTPS/localhost, permissions, and Brave Shields.');
            }
        }

        function stopCamera() {
            scanningActive = false;
            if (rafId) cancelAnimationFrame(rafId);
            rafId = null;
            if (video) {
                video.pause();
                video.srcObject = null;
                video.classList.add('hidden');
            }
            if (currentStream) {
                currentStream.getTracks().forEach(t => t.stop());
                currentStream = null;
            }
            stopBtn.disabled = true;
            flipBtn.disabled = true;
            qrResult.classList.add('hidden');
            cameraPlaceholder.classList.remove('hidden');
        }

        // ------- Scanning -------
        function drawToCanvas() {
            const vw = video.videoWidth;
            const vh = video.videoHeight;
            if (!vw || !vh) return false;
            canvas.width = vw;
            canvas.height = vh;
            ctx.drawImage(video, 0, 0, vw, vh);
            return true;
        }

        async function scanOnce() {
            // Primary: BarcodeDetector
            if (usingBarcodeDetector && detector) {
                try {
                    const barcodes = await detector.detect(video);
                    if (barcodes && barcodes.length) {
                        return barcodes[0].rawValue || null;
                    }
                } catch (e) {
                    // If detection throws, silently fallback to jsQR below
                }
            }

            // Fallback: jsQR from canvas
            if (!window.jsQR) return null; // still loading or failed
            if (!drawToCanvas()) return null;
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = window.jsQR(imageData.data, imageData.width, imageData.height, { inversionAttempts: 'dontInvert' });
            if (code && code.data) return code.data;
            return null;
        }

        async function scanLoop() {
            if (!scanningActive) return;
            const val = await scanOnce();
            if (val) {
                showQRResult(val);
                // Light haptic on mobile
                if ('vibrate' in navigator) navigator.vibrate(50);
                // Stop scanning but keep camera active
                scanningActive = false;
                if (rafId) cancelAnimationFrame(rafId);
                return;
            }
            // Throttle via rAF; actual work is async
            rafId = requestAnimationFrame(scanLoop);
        }

        function showQRResult(text) {
            scannedData = text;
            qrResult.classList.remove('hidden');
            qrText.textContent = text;
        }

        // ------- Verification API -------
        async function verifyTicket(ticketId) {
            try {
                // Replace with your actual FastAPI endpoint
                const response = await fetch('/verify-ticket', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ ticket_id: ticketId })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                return result.valid || false;
            } catch (error) {
                console.error('Error verifying ticket:', error);
                return false;
            }
        }

        // ------- UI Event Handlers -------
        scanButton.addEventListener('click', function () {
            cameraContainer.classList.remove('hidden');
            scanButton.style.display = 'none';
            // Auto-start camera on secure origins
            if (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                startCamera();
            }
        });

        closeCameraButton.addEventListener('click', function () {
            cameraContainer.classList.add('hidden');
            scanButton.style.display = 'flex';
            stopCamera();
        });

        startBtn.addEventListener('click', () => startCamera());
        stopBtn.addEventListener('click', () => stopCamera());

        flipBtn.addEventListener('click', async () => {
            const next = lastFacing === 'environment' ? 'user' : 'environment';
            // Try to pick device explicitly for reliability
            const devId = await pickDeviceByFacing(next);
            await startCamera(next, devId);
        });

        verifyTicketBtn.addEventListener('click', async function() {
            if (!scannedData) return;
            
            // Show loading state
            verifyTicketBtn.disabled = true;
            verifyTicketBtn.textContent = 'Verifying...';
            
            try {
                const isValid = await verifyTicket(scannedData);
                showVerificationResult(isValid, scannedData);
                qrResult.classList.add('hidden');
                cameraContainer.classList.add('hidden');
                scanButton.style.display = 'flex';
            } catch (error) {
                console.error('Verification error:', error);
                showVerificationResult(false, scannedData);
                qrResult.classList.add('hidden');
                cameraContainer.classList.add('hidden');
                scanButton.style.display = 'flex';
            } finally {
                verifyTicketBtn.disabled = false;
                verifyTicketBtn.textContent = 'Verify Ticket';
            }
        });

        cancelScanBtn.addEventListener('click', function() {
            qrResult.classList.add('hidden');
            startCamera();
        });

        // ------- Original Verification Display Logic -------
        document.addEventListener('DOMContentLoaded', function () {
            const statusContainer = document.getElementById('statusContainer');
            const statusCard = document.getElementById('statusCard');
            const statusIcon = document.getElementById('statusIcon');
            const statusIconElement = document.getElementById('statusIconElement');
            const statusTitle = document.getElementById('statusTitle');
            const statusMessage = document.getElementById('statusMessage');
            const ticketDetails = document.getElementById('ticketDetails');
            const scanAgainButton = document.getElementById('scanAgainButton');

            window.showVerificationResult = function (isValid, ticketId) {
                const ticketData = generateTicketData(isValid, ticketId);

                statusCard.className = 'rounded-lg p-6 text-center';

                if (isValid) {
                    statusCard.classList.add('verification-success');
                    statusIcon.className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-green-500';
                    statusIconElement.className = 'ri-check-line text-2xl text-white';
                    statusTitle.textContent = 'Ticket Verified!';
                    statusTitle.className = 'text-xl font-semibold mb-2 text-green-800';
                    statusMessage.textContent = 'This ticket is valid and can be used for entry.';
                    statusMessage.className = 'text-sm mb-4 text-green-700';

                    document.getElementById('ticketId').textContent = ticketData.id;
                    ticketDetails.classList.remove('hidden');
                } else {
                    statusCard.classList.add('verification-error');
                    statusIcon.className = 'w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-red-500';
                    statusIconElement.className = 'ri-close-line text-2xl text-white';
                    statusTitle.textContent = 'Invalid Ticket';
                    statusTitle.className = 'text-xl font-semibold mb-2 text-red-800';
                    statusMessage.textContent = 'This ticket is not valid. Please check with the ticket holder.';
                    statusMessage.className = 'text-sm mb-4 text-red-700';
                    ticketDetails.classList.add('hidden');
                }

                statusCard.classList.remove('hidden');
                statusContainer.classList.add('show');

                addToRecentScans(ticketData, isValid);
            };

            scanAgainButton.addEventListener('click', function () {
                statusContainer.classList.remove('show');
                setTimeout(() => {
                    statusCard.classList.add('hidden');
                }, 400);
                // Reset camera view
                cameraContainer.classList.remove('hidden');
                scanButton.style.display = 'none';
                startCamera();
            });
        });

        // ------- Original Ticket Data Generator -------
        document.addEventListener('DOMContentLoaded', function () {
            const events = [
                'Summer Music Festival 2024',
                'Tech Conference Pro',
                'Art Gallery Opening',
                'Comedy Night Special',
                'Food & Wine Expo'
            ];

            const names = [
                'Alex Johnson', 'Sarah Chen', 'Michael Rodriguez', 'Emma Thompson',
                'David Kim', 'Lisa Anderson', 'James Wilson', 'Maria Garcia'
            ];

            window.generateTicketData = function (isValid, ticketId) {
                const now = new Date();
                const eventDate = new Date(now.getTime() + Math.random() * 30 * 24 * 60 * 60 * 1000);

                return {
                    id: isValid ? (ticketId || `TK-2024-${String(Math.floor(Math.random() * 9999)).padStart(3, '0')}`) : 'INVALID',
                    event: events[Math.floor(Math.random() * events.length)],
                    date: eventDate.toLocaleDateString('en-US', {
                        weekday: 'short',
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    }),
                    holder: names[Math.floor(Math.random() * names.length)]
                };
            };

            window.addToRecentScans = function (ticketData, isValid) {
                const recentScans = document.getElementById('recentScans');
                const now = new Date();

                const scanItem = document.createElement('div');
                scanItem.className = 'flex items-center justify-between py-2 px-3 bg-gray-50 rounded';

                const iconClass = isValid ? 'ri-check-line text-green-600' : 'ri-close-line text-red-600';
                const iconBg = isValid ? 'bg-green-100' : 'bg-red-100';
                const statusText = isValid ? 'Valid' : 'Invalid';
                const statusColor = isValid ? 'text-green-600' : 'text-red-600';

                scanItem.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-6 h-6 flex items-center justify-center ${iconBg} rounded-full">
                            <i class="${iconClass} text-sm"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">${ticketData.id}</p>
                            <p class="text-xs text-gray-500">Just now</p>
                        </div>
                    </div>
                    <span class="text-xs ${statusColor} font-medium">${statusText}</span>
                `;

                recentScans.insertBefore(scanItem, recentScans.firstChild);

                if (recentScans.children.length > 5) {
                    recentScans.removeChild(recentScans.lastChild);
                }
            };
        });
    </script>
    <script>
        !function (t, e) { var o, n, p, r; e.__SV || (window.posthog = e, e._i = [], e.init = function (i, s, a) { function g(t, e) { var o = e.split("."); 2 == o.length && (t = t[o[0]], e = o[1]), t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } } (p = t.createElement("script")).type = "text/javascript", p.crossOrigin = "anonymous", p.async = !0, p.src = s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") + "/static/array.js", (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r); var u = e; for (void 0 !== a ? u = e[a] = [] : a = "posthog", u.people = u.people || [], u.toString = function (t) { var e = "posthog"; return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e }, u.people.toString = function () { return u.toString(1) + ".people (stub)" }, o = "init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "), n = 0; n < o.length; n++)g(u, o[n]); e._i.push([i, s, a]) }, e.__SV = 1) }(document, window.posthog || []);
        posthog.init('phc_t9tkQZJiyi2ps9zUYm8TDsL6qXo4YmZx0Ot5rBlAlEd', {
            api_host: 'https://us.i.posthog.com',
            autocapture: false,
            capture_pageview: false,
            capture_pageleave: false,
            capture_performance: {
                web_vitals: false,
            },
            rageclick: false,
        })
        window.shareKey = 'MBki4FJUnXd5UggVDGLlBg';
        window.host = 'readdy.ai';
    </script>
</body>

</html>